<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GoodCall AI</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React UMD -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Lucide React UMD -->
  <script src="https://unpkg.com/lucide-react/dist/umd/lucide-react.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      background:#0c0a09;
      color:white;
      margin:0;
    }
    .no-scrollbar::-webkit-scrollbar { display:none; }
    .no-scrollbar { scrollbar-width:none; }
  </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">

/* ------------------ GLOBALS ------------------ */
const { useState, useEffect, useRef } = React;
const {
  X, Check, AlertTriangle, Zap, ThumbsDown, ThumbsUp,
  Activity, User, History, Scan, Flame, IndianRupee,
  Barcode, MapPin, Clock, BrainCircuit, ChevronRight,
  ArrowRight, HelpCircle, EyeOff, Target, Leaf, Plus, ChevronLeft
} = lucideReact;

/* ---------------- CONFIG ---------------- */
/* ðŸ‘‰ ADD YOUR GEMINI API KEY HERE */
const API_KEY = ""; // optional â€“ demo works without it

/* ---------------- DATA ---------------- */
const DEFAULT_GOALS = [
  { id:'gut', label:'Gut Health', sub:'Low FODMAP', icon:<Activity size={20}/>, color:'text-blue-400', bg:'bg-blue-500/20', border:'border-blue-500/50' },
  { id:'sugar', label:'Insulin Control', sub:'Low Sugar', icon:<Zap size={20}/>, color:'text-yellow-400', bg:'bg-yellow-500/20', border:'border-yellow-500/50' },
  { id:'vegan', label:'Plant Based', sub:'No Animal', icon:<Leaf size={20}/>, color:'text-emerald-400', bg:'bg-emerald-500/20', border:'border-emerald-500/50' }
];

const SCENARIO_IMAGES = [
  "https://images.unsplash.com/photo-1583258292688-d0213dc5a3a8",
  "https://images.unsplash.com/photo-1542838132-92c53300491e",
  "https://images.unsplash.com/photo-1610832958506-aa56368176cf"
];

const MOCK_PRODUCTS = {
  good:{ name:"Oatly Barista", brand:"Oatly", verdict:"Protocol Match", reason:"Fits your protocol.", pros:["High Fiber"], cons:[], sentiment:"positive", matchScore:94, calories:140, price:399 },
  bad:{ name:"Sugary Puffs", brand:"Kelloggs", verdict:"Goal Conflict", reason:"Too much sugar.", pros:[], cons:["High Sugar"], sentiment:"negative", matchScore:32, calories:210, price:249 },
  uncertain:{ name:"Unknown Mix", brand:"Unknown", verdict:"Label Unclear", reason:"Ingredients unclear.", pros:[], cons:["Ambiguous"], sentiment:"uncertain", matchScore:0, calories:0, price:0 }
};

/* ---------------- AI SERVICE ---------------- */
class GeminiService {
  static async analyzeProduct(context, goal){
    if(!API_KEY){
      await new Promise(r=>setTimeout(r,1200));
      if(context.includes("Oatly")) return MOCK_PRODUCTS.good;
      if(context.includes("Sugary")) return MOCK_PRODUCTS.bad;
      return MOCK_PRODUCTS.uncertain;
    }

    const res = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`,
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({
          contents:[{parts:[{text:`Analyze ${context} for ${goal}. Return JSON.`}]}]
        })
      }
    );

    const data = await res.json();
    return JSON.parse(data.candidates[0].content.parts[0].text);
  }
}

/* ---------------- UI COMPONENTS ---------------- */
const MatchScoreRing = ({score}) => (
  <div className="w-16 h-16 rounded-full bg-stone-900 flex items-center justify-center font-bold">
    {score}
  </div>
);

/* ---------------- APP ---------------- */
function App(){
  const [view,setView]=useState("camera");
  const [activeProduct,setActiveProduct]=useState(null);
  const [goal,setGoal]=useState(DEFAULT_GOALS[0]);
  const [bg,setBg]=useState(SCENARIO_IMAGES[0]);

  const scan = async(type)=>{
    setBg(SCENARIO_IMAGES[Math.floor(Math.random()*3)]);
    const ctx = type==="good"?"Oatly":"Sugary";
    const res = await GeminiService.analyzeProduct(ctx,goal.label);
    setActiveProduct(res);
    setView("decision");
  };

  return (
    <div className="h-screen sm:max-w-md sm:mx-auto relative overflow-hidden">
      {view==="camera" && (
        <div className="h-full relative">
          <img src={bg} className="absolute inset-0 w-full h-full object-cover opacity-70"/>
          <div className="absolute inset-0 bg-black/50"/>
          <div className="absolute bottom-8 w-full px-6 space-y-3">
            <button onClick={()=>scan("good")} className="w-full bg-emerald-500 py-4 rounded-xl font-bold">Healthy Scan</button>
            <button onClick={()=>scan("bad")} className="w-full bg-rose-500 py-4 rounded-xl font-bold">Unhealthy Scan</button>
            <button onClick={()=>scan("uncertain")} className="w-full bg-amber-500 py-4 rounded-xl font-bold">Unclear Label</button>
          </div>
        </div>
      )}

      {view==="decision" && activeProduct && (
        <div className="absolute inset-0 bg-white text-black p-8 rounded-t-[40px] flex flex-col justify-between">
          <div>
            <span className="text-xs uppercase tracking-widest text-stone-400">{activeProduct.brand}</span>
            <h1 className="text-3xl font-black">{activeProduct.verdict}</h1>
            <p className="text-stone-600 mt-2">{activeProduct.reason}</p>
          </div>
          <div className="flex items-center justify-between mt-6">
            <MatchScoreRing score={activeProduct.matchScore}/>
            <button onClick={()=>setView("camera")} className="bg-stone-900 text-white px-6 py-3 rounded-xl font-bold">Scan Again</button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>
</body>
</html>
