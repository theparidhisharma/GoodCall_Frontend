<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GoodCall – AI Food Copilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel (JSX support) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide React (UMD) -->
  <script src="https://unpkg.com/lucide-react/dist/umd/lucide-react.development.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #0c0a09;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const {
      X, Check, AlertTriangle, Zap, ThumbsDown, ThumbsUp,
      Activity, User, History, Scan, Flame, IndianRupee,
      Barcode, MapPin, Clock, BrainCircuit, ChevronRight,
      ArrowRight, HelpCircle, EyeOff, Target, Leaf, Plus, ChevronLeft
    } = lucideReact;

    /* ---------------- CONFIG ---------------- */
    const API_KEY = "";

    /* ---------------- CONSTANTS ---------------- */
    const DEFAULT_GOALS = [
      { id: 'gut', label: 'Gut Health', sub: 'No Bloating / Low FODMAP', icon: <Activity size={20}/>, color: 'text-blue-400', bg: 'bg-blue-500/20', border: 'border-blue-500/50' },
      { id: 'sugar', label: 'Insulin Control', sub: 'Strict Low Sugar', icon: <Zap size={20}/>, color: 'text-yellow-400', bg: 'bg-yellow-500/20', border: 'border-yellow-500/50' },
      { id: 'vegan', label: 'Plant Based', sub: 'No Animal Products', icon: <Leaf size={20}/>, color: 'text-emerald-400', bg: 'bg-emerald-500/20', border: 'border-emerald-500/50' },
    ];

    const SCENARIO_IMAGES = [
      "https://images.unsplash.com/photo-1583258292688-d0213dc5a3a8?auto=format&fit=crop&q=80&w=800",
      "https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&q=80&w=800",
      "https://images.unsplash.com/photo-1610832958506-aa56368176cf?auto=format&fit=crop&q=80&w=800",
    ];

    /* ---------------- MOCK AI ---------------- */
    class GeminiService {
      static async analyzeProduct(context, goal) {
        await new Promise(r => setTimeout(r, 1200));
        if (context.includes("Oatly")) {
          return {
            name: "Oatly Barista",
            brand: "Oatly",
            verdict: "Protocol Match",
            reason: `Fits your ${goal} protocol perfectly.`,
            pros: ["High Fiber", "No Added Sugar"],
            cons: [],
            sentiment: "positive",
            matchScore: 94,
            calories: 140,
            price: "₹399",
            image: "https://images.unsplash.com/photo-1600718374662-0483d2b9da44"
          };
        }
        if (context.includes("Sugary")) {
          return {
            name: "Sugary Puffs",
            brand: "Kelloggs",
            verdict: "Goal Conflict",
            reason: `Violates your ${goal} limit.`,
            pros: [],
            cons: ["High Sugar"],
            sentiment: "negative",
            matchScore: 32,
            calories: 210,
            price: "₹249",
            image: "https://images.unsplash.com/photo-1528750596323-952a233306ae"
          };
        }
        return {
          name: "Unknown",
          brand: "Unknown",
          verdict: "Label Unclear",
          reason: "Cannot verify ingredients safely.",
          pros: [],
          cons: ["Ambiguous Label"],
          sentiment: "uncertain",
          matchScore: 0,
          calories: 0,
          price: "N/A",
          image: "https://images.unsplash.com/photo-1596040033229-a9821ebd058d"
        };
      }
    }

    /* ---------------- APP ---------------- */
    function App() {
      const [view, setView] = useState("camera");
      const [activeProduct, setActiveProduct] = useState(null);
      const [scanning, setScanning] = useState(false);
      const [goals, setGoals] = useState(DEFAULT_GOALS);
      const [activeGoalId, setActiveGoalId] = useState("gut");
      const [bgImage, setBgImage] = useState(SCENARIO_IMAGES[0]);

      const activeGoal = goals.find(g => g.id === activeGoalId);

      const simulateScan = async (type) => {
        setScanning(true);
        setBgImage(SCENARIO_IMAGES[Math.floor(Math.random()*3)]);
        const prompt =
          type === "good"
            ? "Oatly Barista"
            : type === "bad"
            ? "Sugary Puffs"
            : "Unclear spices";
        const result = await GeminiService.analyzeProduct(prompt, activeGoal.label);
        setActiveProduct(result);
        setScanning(false);
        setView("decision");
      };

      return (
        <div className="w-full h-screen bg-stone-950 text-white overflow-hidden sm:max-w-md sm:mx-auto">
          {view === "camera" && (
            <div className="relative h-full">
              <img src={bgImage} className="absolute inset-0 w-full h-full object-cover opacity-60" />
              <div className="absolute inset-0 bg-black/40" />
              <div className="absolute bottom-6 w-full px-6">
                <div className="bg-black/60 rounded-3xl p-4 space-y-3">
                  <button onClick={() => simulateScan("good")} className="w-full bg-emerald-500 py-3 rounded-xl font-bold">Healthy Scan</button>
                  <button onClick={() => simulateScan("bad")} className="w-full bg-rose-500 py-3 rounded-xl font-bold">Unhealthy Scan</button>
                  <button onClick={() => simulateScan("uncertain")} className="w-full bg-amber-500 py-3 rounded-xl font-bold">Unclear Label</button>
                </div>
              </div>
            </div>
          )}

          {view === "decision" && activeProduct && (
            <div className="h-full flex flex-col justify-end bg-white text-black p-8 rounded-t-[40px]">
              <h1 className="text-3xl font-black">{activeProduct.verdict}</h1>
              <p className="text-stone-600 mt-2">{activeProduct.reason}</p>
              <button onClick={() => setView("camera")} className="mt-6 bg-stone-900 text-white py-4 rounded-xl font-bold">Scan Again</button>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
